function init(){for(i=0;i<num_loaded_pages;i++){var e=$("#p"+i+"_img");e.attr("src",path_big+e.attr("big"))}$("#p0").show();TweenMax.to($("#text_iframe"),0,{z:.5});TweenMax.to($("#text_iframe_close"),0,{z:.6});TweenMax.to($("#dark_overlay"),0,{z:.5});$("#text_iframe").hammer().on("mousedown touchstart tap",function(e){e.preventDefault();e.stopPropagation()});$("#text_iframe_close, #dark_overlay").hammer().on("mouseup touchend tap",function(e){e.preventDefault();hideTextIframe()});$("#fancybox-img").live("mousedown touchstart",function(e){hideAll();e.preventDefault();e.stopPropagation()});$("#fancybox-close").live("mousedown touchstart",function(e){hideAll();e.stopPropagation()});TweenMax.to($(".map_area"),0,{z:.2,opacity:map_area_opacity});createMapsEvents();$(".icon").hammer().on("mouseover",function(){TweenMax.to($(this),.3,{rotationZ:20,ease:Quad.easeOut})}).hammer().on("mouseout",function(){TweenMax.to($(this),.3,{rotationZ:0,ease:Quad.easeOut})});$(".map").hammer().on("mouseover",function(e){TweenMax.to($(this),.3,{scale:1.05,ease:Quad.easeOut});e.preventDefault()}).hammer().on("mouseout",function(e){TweenMax.to($(this),.3,{scale:1,ease:Quad.easeOut});e.preventDefault();e.stopPropagation()});$("#thumbs").width(ww);initThumbScroll();$("#thumbs").hammer().on("mouseup touchend",function(e){e.preventDefault()}).hammer().on("tap",function(e){e.preventDefault();e.stopPropagation()});$(".thumb").hammer().on("mouseover",function(){TweenMax.to($(this),.3,{opacity:.3})}).hammer().on("mouseout",function(){TweenMax.to($(this),.3,{opacity:1})});$(".thumb").hammer().on("mouseup touchend",function(e){if(!iscroll_thumbs_dragging){var t=parseInt($(this).attr("id_thumb"));gotoPage(t);e.preventDefault()}}).hammer().on("tap",function(e){e.preventDefault();e.stopPropagation()});$("#sommario, #sommario_content").hammer().on("mouseup touchend",function(e){e.preventDefault()}).hammer().on("tap",function(e){e.preventDefault();e.stopPropagation()});$(".index_item").hammer().on("mouseup touchend",function(e){if(!iscroll_sommario_dragging){var t=parseInt($(this).attr("p"));gotoPage(t);e.preventDefault()}}).hammer().on("tap",function(e){e.preventDefault();e.stopPropagation()});$("#icon_thumbs").hammer().on("mouseup touchend",function(e){toggleThumbs();e.preventDefault()}).hammer().on("tap",function(e){e.preventDefault();e.stopPropagation()});$("#icon_index").hammer().on("mouseup touchend",function(e){toggleSommario();e.preventDefault()}).hammer().on("tap",function(e){e.preventDefault();e.stopPropagation()});$("#icon_fullscreen").hammer().on("mouseup touchend",function(e){fullscreen?$.fullscreen.exit():$("body").fullscreen();fullscreen=!fullscreen;e.preventDefault()}).hammer().on("tap",function(e){e.preventDefault();e.stopPropagation()});$(document).on("touchcancel",function(e){e.preventDefault()});$(document).live("touchmove",function(e){e.preventDefault()});$(document).off("scroll");$(window).scroll(function(e){e.preventDefault();e.stopPropagation();return false});$("#arrow_left, #arrow_right").bind("mouseover",function(e){TweenMax.to($(this),.2,{opacity:.4});e.stopPropagation();return false}).bind("mouseout",function(e){TweenMax.to($(this),.2,{opacity:1});e.stopPropagation();return false});$("#arrow_left").hammer().on("mouseup touchend",function(e){turnRight();e.preventDefault()}).hammer().on("mousedown touchstart tap",function(e){e.preventDefault();e.stopPropagation()});$("#arrow_right").hammer().on("mouseup touchend",function(e){turnLeft();e.preventDefault()}).hammer().on("mousedown touchstart tap",function(e){e.preventDefault();e.stopPropagation()});$(document).keyup(function(e){if(e.keyCode==37){turnRight()}else if(e.keyCode==39){turnLeft()}});var t=$("#logo_img").attr("src");$("#logo_img").attr("src","").one("load",function(){resizeLogo()}).attr("src",t).each(function(){if(this.complete)$(this).load()});enablePageEvents();determineView();initBook();TweenMax.to($("#preload_bg"),.3,{delay:0,z:.1,autoAlpha:0,ease:Linear.easeNone});TweenMax.to($("#book"),.5,{delay:.5,z:.1,opacity:1,ease:Linear.easeNone,onComplete:function(){showHeader(0);showArrows(0);showMaps(0)}})}function initBook(){TweenMax.killAll();if(view=="two"){TweenMax.to($("#p0"),0,{z:.1,x:page_width,zIndex:3,transformOrigin:"left center",rotationY:0});for(var e=1;e<num_pages;e++){var t=e%2==1?"right center":"left center";var n=e%2==1?0:page_width;var r=e%2==1?180:0;TweenMax.to($("#p"+e),0,{z:.1,x:n,zIndex:0,transformOrigin:t,rotationY:r})}}else{TweenMax.to($("#p0"),0,{z:.1,x:page_width,zIndex:3,transformOrigin:"left center",rotationY:0});for(var e=1;e<num_pages;e++)TweenMax.to($("#p"+e),0,{z:.1,x:page_width,zIndex:0,transformOrigin:"left center",rotationY:0})}changeBookOrigin()}function toggleView(){view=view=="two"?"one":"two";changeView()}function determineView(){if(typeof view==="undefined"){if(is_mobile&&$(window).width()<$(window).height())view="one";else view="two"}else{if(window.orientation==0||window.orientation==180)view="one";else view="two"}if(is_phone){if(view=="one")$(".social_icon").hide();else $(".social_icon").show()}if(force_one_page)view="one";if(num_p!=-1)view=num_p==2?"two":"one"}function onOrientationChange(){onStopZoom(0);determineView();resizeAll();initBook();gotoCurrentPage()}function gotoCurrentPage(){var e=current_page;if(view=="one"&&e>num_pages-1)e=num_pages-1;current_page=-1;if(from_p!=-1){gotoPage(from_p-1);from_p=-1}else{gotoPage(e)}}function resizeLogo(){logo_width=$("#logo_img").width();logo_height=$("#logo_img").height();if(logo_width==0||logo_height==0)return false;var e=logo_width/logo_height;var t=ww-$("#header_right").width()-40;var n=50;if(logo_height>n){logo_height=n;logo_width=logo_height*e}if(logo_width>t){$("#logo_img").width(t);$("#logo_img").height(t/e);$("#logo_img").css("margin-top",($("#header").height()-t/e)/2)}else{$("#logo_img").width(logo_width);$("#logo_img").height(logo_height);$("#logo_img").css("margin-top",($("#header").height()-logo_height)/2)}$("#logo_img").show()}function onResize(){onStopZoom();resizeAll()}function resizeAll(){ww=$(window).width();wh=$(window).height();TweenMax.to($("#debug"),0,{z:.3,width:300,height:wh,x:0,y:0});resizeBook();manageCoverViews(current_page,0);resizePreload();resizeOverlay();resizeTextIframe();scaleMaps();if(!first_time_resize)resizeLogo();first_time_resize=false;$("#sommario").height(wh-60);sommario_left=-$("#sommario").width()-60;TweenMax.to($("#sommario"),0,{z:.3,x:sommario_left,width:$("#sommario").width()});initSommario();$("#thumbs").width(ww);initThumbScroll();var e=hide_header?0:60;TweenMax.to($("#arrow_left"),0,{height:wh,x:arrows_visible?0:-100});TweenMax.to($("#arrow_right"),0,{height:wh,x:arrows_visible?ww-arrow_bar_width:ww+10});TweenMax.to($("#arrow_left img"),0,{x:(arrow_bar_width-arrow_left_width)/2,y:(wh-arrow_left_height)/2-e});TweenMax.to($("#arrow_right img"),0,{x:(arrow_bar_width-arrow_right_width)/2,y:(wh-arrow_right_height)/2-e});if(hide_header){TweenMax.to($("#arrow_left"),0,{top:0});TweenMax.to($("#arrow_right"),0,{top:0})}}function resizeBook(){if(view=="two"){main_dimension="h";page_height=wh-banner_height;page_width=Math.ceil(page_height*image_ratio);var e=0;if(page_width>ww/2){main_dimension="w";page_width=ww/2;page_height=Math.ceil(page_width/image_ratio);e=(wh-page_height-banner_height)/2}perspective=page_width*perspective_multiplier;TweenMax.to($("#book"),0,{perspective:perspective});book_y=current_book_y=last_book_y=e;TweenMax.to($("#book"),0,{z:.1,y:e,width:page_width*2,height:page_height});TweenMax.to($("#big"),0,{y:e,width:page_width*2,height:page_height});TweenMax.to($("#oleft"),0,{z:.1,x:0,width:page_width,height:page_height});TweenMax.to($("#oright"),0,{z:.1,x:page_width,width:page_width,height:page_height});for(var t=0;t<num_pages;t++){var n=t%2==1?0:page_width;TweenMax.to($("#p"+t),0,{z:.1,x:n,width:page_width,height:page_height})}}else{main_dimension="h";page_height=wh-banner_height;page_width=Math.ceil(page_height*image_ratio);var e=0;if(page_width>ww){main_dimension="w";page_width=ww;page_height=Math.ceil(page_width/image_ratio);e=(wh-page_height-banner_height)/2}perspective=page_width*perspective_multiplier;TweenMax.to($("#book"),0,{perspective:perspective});book_y=current_book_y=last_book_y=e;TweenMax.to($("#book"),0,{z:.1,y:e,width:page_width*2,height:page_height});TweenMax.to($("#big"),0,{y:e,width:page_width*2,height:page_height});TweenMax.to($("#oleft"),0,{z:.1,x:0,width:page_width,height:page_height});TweenMax.to($("#oright"),0,{z:.1,x:page_width,width:page_width,height:page_height});for(var t=0;t<num_pages;t++)TweenMax.to($("#p"+t),0,{z:.1,x:page_width,width:page_width,height:page_height})}$(".page_img").width(page_width);$(".page_img").height(page_height)}function changeBookOrigin(){if(view=="one"){book_page_view="right";e="75% center"}else{var e="center center";book_page_view="center";if(current_page==0){book_page_view="right";e="75% center"}else if(current_page>=num_pages-1){book_page_view="left";e="25% center"}}TweenMax.to($("#book"),0,{transformOrigin:e});TweenMax.to($("#big"),0,{transformOrigin:e})}function moveLarge(e){e=typeof e!=="undefined"?e:.3;var t=2*page_width*current_zoom;var n=page_height*current_zoom;if(book_page_view=="center"){if(t>ww){current_large_x=Math.min(0,current_large_x);current_large_x=Math.max(ww-t,current_large_x)}else current_large_x=(ww-2*page_width*current_zoom)/2}else if(book_page_view=="right"){if(t/2>ww){current_large_x=Math.min(-page_width*current_zoom,current_large_x);current_large_x=Math.max(ww-t,current_large_x)}else current_large_x=(ww-3*page_width*current_zoom)/2}else if(book_page_view=="left"){if(t/2>ww){current_large_x=Math.min(0,current_large_x);current_large_x=Math.max(ww-t/2,current_large_x)}else current_large_x=(wh-1*page_width*current_zoom)/2}if(n>wh){current_large_y=Math.min(0,current_large_y);current_large_y=Math.max(wh-n,current_large_y)}else current_large_y=(wh-page_height*current_zoom)/2;TweenMax.to($("#large"),e,{x:current_large_x,y:current_large_y})}function onTap(){if(zoomed)return false;if(header_opened){hideAll()}else{showHeader(.2);showArrows(.2)}}function enablePageEvents(){if(embed){$("#book").click(function(){window.open(mag_url,"Mokazine")});return false}$(document).hammer().on("tap",function(e){console.log("DOCUMENT: "+e.type);if(!popup_opened)onTap()});$("#large").hammer().on("touch drag release pinchin doubletap",function(e){var t=e.gesture.touches.length;var n=e.gesture.distance;var r=e.gesture.direction;var i=e.gesture.deltaX;var s=e.gesture.deltaY;var o=parseInt($(e.currentTarget).attr("n"));var u=e.gesture.scale;var a=u>=1?u-1:-(1-u)*10;a*=zoom_speed;if(e.type=="doubletap"){e.preventDefault();e.stopPropagation();if(zoomed)onStopZoom();return false}if(e.type=="pinchin"){e.preventDefault();e.stopPropagation();if(zoomed)onStopZoom();return false}if(t==1){if(zoomed){switch(e.type){case"touch":start_drag_zoomed=true;last_large_x=current_large_x;last_large_y=current_large_y;break;case"drag":e.gesture.preventDefault();if(start_drag_zoomed){current_large_x=last_large_x+i;current_large_y=last_large_y+s;moveLarge();largeToBigCoords();TweenMax.to($("#big"),.3,{x:current_big_x,y:current_big_y})}break;case"release":start_drag_zoomed=false;break}}}});$(".page").hammer().on("touch drag release transform transformstart transformend pinchin pinchout doubletap",function(e){console.log("PAGE: "+e.type);var t=e.gesture.touches.length;var n=e.gesture.distance;var r=e.gesture.direction;var i=e.gesture.deltaX;var s=e.gesture.deltaY;var o=parseInt($(e.currentTarget).attr("n"));var u=e.gesture.scale;var a=u>=1?u-1:-(1-u)*10;a*=zoom_speed;if(e.type=="doubletap"){e.preventDefault();e.stopPropagation();if(!zoomed)onStartZoom();return false}if(e.type=="pinchout"){e.preventDefault();e.stopPropagation();if(!zoomed)onStartZoom();return false}if(t==1){if(!zoomed){switch(e.type){case"touch":break;case"drag":e.gesture.preventDefault();if(view=="two"){if(!turning&&Math.abs(i)>1)onStartTurn(e);else if(turning&&!completing)onTurn(r,i)}else{if(!turning&&n>one_page_drag_threshold){if(r=="left")onStartTurnOneLeft(o);else onStartTurnOneRight(o)}if(turning&&!completing){if(one_page_turn_direction=="left")onTurnOneLeft(r,n);else onTurnOneRight(r,n)}}break;case"release":break}}}});$(document).hammer().on("release",function(e){console.log("DOCUMENT2: "+e.type);var t=e.gesture.touches.length;var n=e.gesture.distance;var r=e.gesture.direction;var i=e.gesture.deltaX;var s=e.gesture.deltaY;var o=parseInt($(e.currentTarget).attr("n"));var u=e.gesture.scale;var a=u>=1?u-1:-(1-u)*10;a*=zoom_speed;if(t==1&&!zoomed&&e.type=="release"){if(view=="two"){if(turning&&!completing)onEndTurn(r,i)}else{if(turning&&!completing){if(one_page_turn_direction=="left")onEndTurnOneLeft(r,i);else onEndTurnOneRight(r,i)}}}})}function bigToLargeCoords(){if(book_page_view=="center")current_large_x=current_big_x-(2*page_width*current_zoom-2*page_width)/2;else if(book_page_view=="right")current_large_x=current_big_x-(3*page_width*current_zoom-3*page_width)/2;else if(book_page_view=="left")current_large_x=current_big_x-(1*page_width*current_zoom-1*page_width)/2;current_large_y=current_big_y-(page_height*current_zoom-page_height)/2}function largeToBigCoords(){if(book_page_view=="center")current_big_x=current_large_x+(page_width*current_zoom-page_width);else if(book_page_view=="right")current_big_x=current_large_x+(page_width*current_zoom-page_width)*3/2;else if(book_page_view=="left")current_big_x=current_large_x+(page_width*current_zoom-page_width)*1/2;current_big_y=current_large_y+(page_height*current_zoom-page_height)/2}function loadLarge(){if(book_page_view!="left"){var e=$("#p"+current_page+"_img").attr("big");$("#large_right").attr("src",path_large+e).show()}if(book_page_view!="right"){var t=$("#p"+(current_page-1)+"_img").attr("big");$("#large_left").attr("src",path_large+t).show()}bigToLargeCoords();TweenMax.to($("#large"),0,{z:.1,x:current_large_x,y:current_large_y,width:2*page_width*current_zoom,height:page_height*current_zoom,onComplete:function(){$("#large").show()}})}function onStopZoom(e){e=typeof e!=="undefined"?e:.4;$("#large").hide(0,function(){current_zoom=1;TweenMax.to($("#big"),e,{z:.1,scale:1,x:book_x,y:book_y,onComplete:function(){current_zoom=1;zoomed=false;$("#book").show();$("#big").hide();showMaps(current_page);if(view=="two")showMaps(current_page-1)}})})}function onStartZoom(){hideAll();current_big_x=book_x;current_big_y=book_y;zoomed=true;hideAllMaps();last_zoom=current_zoom=max_zoom;$("#big_right").attr("src","").hide();$("#big_left").attr("src","").hide();$("#large_right").attr("src","").hide();$("#large_left").attr("src","").hide();if(book_page_view!="left"){var e=$("#p"+current_page+"_img").attr("big");$("#big_right").attr("src",path_big+e).show()}if(book_page_view!="right"){var t=$("#p"+(current_page-1)+"_img").attr("big");$("#big_left").attr("src",path_big+t).show()}$("#large").hide();$("#book").hide();$("#big").show(0,function(){TweenMax.to($("#big"),.4,{z:.1,scale:current_zoom,onUpdate:function(){},onComplete:function(){loadLarge()}})})}function toggleZoom(){if(!zoomed)onStartZoom();else onStopZoom()}function onStartTurnOneLeft(e){if(current_page>=num_pages-1)return false;turning=true;one_page_turn_direction="left";hideAllMaps();drag_page=e;obj["angle"]=0;$(".page").css("zIndex",0);$("#p"+drag_page).css("zIndex",3);$("#p"+(drag_page+1)).css("zIndex",1);$(".page").hide();$("#p"+drag_page).show();$("#p"+(drag_page+1)).show();TweenMax.to($("#oright"),0,{opacity:0});$("#oright").show()}function onStartTurnOneRight(e){if(current_page<=0)return false;turning=true;one_page_turn_direction="right";hideAllMaps();drag_page=e-1;obj["angle"]=0;$(".page").css("zIndex",0);$("#p"+drag_page).css("zIndex",3);$("#p"+(drag_page+1)).css("zIndex",1);$(".page").hide();$("#p"+drag_page).show();$("#p"+(drag_page+1)).show();TweenMax.to($("#oright"),0,{opacity:0});$("#oright").show()}function onTurnOneLeft(e,t){t=e=="left"?-t:t;var n=one_page_max_angle*t/page_width;var r;n=Math.max(n,-one_page_max_angle);n=Math.min(n,0);TweenMax.to(obj,speed_on_dragging,{angle:n});TweenMax.to($("#p"+drag_page),speed_on_dragging,{z:.1,rotationY:n});var r=1+n/90;TweenMax.to($("#oright"),speed_on_dragging,{opacity:r*max_overlay_opacity})}function onTurnOneRight(e,t){t=e=="left"?-t:t;var n=one_page_max_angle*t/page_width;var r;n=Math.min(n,one_page_max_angle);n=Math.max(n,0);TweenMax.to(obj,speed_on_dragging,{angle:n});TweenMax.to($("#p"+drag_page),speed_on_dragging,{z:.1,rotationY:n-one_page_max_angle});var r=1-(one_page_max_angle-n)/90;TweenMax.to($("#oright"),speed_on_dragging,{opacity:r*max_overlay_opacity})}function onEndTurnOneLeft(e,t){completing=true;if(-t>drag_threshold){TweenMax.to(obj,speed_complete_turn_one,{angle:-one_page_max_angle,onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn_one,{z:.1,rotationY:-one_page_max_angle});TweenMax.to($("#oright"),speed_complete_turn_one,{opacity:0});current_page+=1}else{TweenMax.to(obj,speed_complete_turn_one,{angle:0,onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn_one,{z:.1,rotationY:0});TweenMax.to($("#oright"),speed_complete_turn_one,{opacity:max_overlay_opacity})}}function onEndTurnOneRight(e,t){completing=true;if(t>drag_threshold){TweenMax.to(obj,speed_complete_turn_one,{angle:one_page_max_angle,onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn_one,{z:.1,rotationY:0});TweenMax.to($("#oright"),speed_complete_turn_one,{opacity:max_overlay_opacity});current_page-=1}else{TweenMax.to(obj,speed_complete_turn_one,{angle:0,onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn_one,{z:.1,rotationY:-one_page_max_angle});TweenMax.to($("#oright"),speed_complete_turn_one,{opacity:0})}}function onStartTurn(e){drag_page=parseInt($(e.currentTarget).attr("n"));if(num_pages%2==0||drag_page<num_pages-1){turning=true;hideAllMaps();preparePageForTurning(drag_page)}}function onTurn(e,t){if(!(num_pages%2==0||drag_page<num_pages-1))return false;var n=180*t/page_width;var r;if(drag_page%2===0){n=Math.max(n,-180);n=Math.min(n,0);TweenMax.to(obj,speed_on_dragging,{angle:n,onUpdate:updateZIndexDuringTurn,onUpdateParams:[drag_page]});TweenMax.to($("#p"+drag_page),speed_on_dragging,{z:.1,rotationY:n});TweenMax.to($("#p"+(drag_page+1)),speed_on_dragging,{z:.1,rotationY:180+n});updateOverlay("right-to-left",n)}else{n=Math.min(n,180);n=Math.max(n,0);TweenMax.to(obj,speed_on_dragging,{angle:n,onUpdate:updateZIndexDuringTurn,onUpdateParams:[drag_page]});TweenMax.to($("#p"+drag_page),speed_on_dragging,{z:.1,rotationY:n});TweenMax.to($("#p"+(drag_page-1)),speed_on_dragging,{z:.1,rotationY:-180+n});updateOverlay("left-to-right",n)}}function onEndTurn(e,t){completing=true;if(drag_page%2===0){if(e=="left"&&-t>drag_threshold){TweenMax.to(obj,speed_complete_turn,{angle:-180,onUpdate:updateZIndexDuringTurn,onUpdateParams:[drag_page],onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn,{z:.1,rotationY:-180});TweenMax.to($("#p"+(drag_page+1)),speed_complete_turn,{z:.1,rotationY:0});if(drag_page>1)TweenMax.to($("#oleft"),speed_complete_turn,{opacity:max_overlay_opacity});TweenMax.to($("#oright"),speed_complete_turn,{opacity:0});manageCoverViews(current_page+2,speed_complete_turn);current_page+=2}else{TweenMax.to(obj,speed_complete_turn,{angle:0,onUpdate:updateZIndexDuringTurn,onUpdateParams:[drag_page],onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn,{z:.1,rotationY:0});TweenMax.to($("#p"+(drag_page+1)),speed_complete_turn,{z:.1,rotationY:180});TweenMax.to($("#oleft"),speed_complete_turn,{opacity:0});if(drag_page<num_pages-2)TweenMax.to($("#oright"),speed_complete_turn,{opacity:max_overlay_opacity})}}else{if(e=="right"&&t>drag_threshold){TweenMax.to(obj,speed_complete_turn,{angle:180,onUpdate:updateZIndexDuringTurn,onUpdateParams:[drag_page],onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn,{z:.1,rotationY:180});TweenMax.to($("#p"+(drag_page-1)),speed_complete_turn,{z:.1,rotationY:0});TweenMax.to($("#oleft"),speed_complete_turn,{opacity:0});if(drag_page<num_pages-2)TweenMax.to($("#oright"),speed_complete_turn,{opacity:max_overlay_opacity});manageCoverViews(current_page-2,speed_complete_turn);current_page-=2}else{TweenMax.to(obj,speed_complete_turn,{angle:0,onUpdate:updateZIndexDuringTurn,onUpdateParams:[drag_page],onComplete:onTurnComplete});TweenMax.to($("#p"+drag_page),speed_complete_turn,{z:.1,rotationY:0});TweenMax.to($("#p"+(drag_page-1)),speed_complete_turn,{z:.1,rotationY:-180});if(drag_page>1)TweenMax.to($("#oleft"),speed_complete_turn,{opacity:max_overlay_opacity});TweenMax.to($("#oright"),speed_complete_turn,{opacity:0})}}}function onTurnComplete(){turning=false;completing=false;$("#oleft").hide();$("#oright").hide();changeBookOrigin();showMaps(current_page);if(view=="two")showMaps(current_page-1);loadPages()}function preparePageForTurning(e){obj["angle"]=0;$(".page").css("zIndex",0);$(".page").hide();$("#p"+(e-2)).show();$("#p"+(e-1)).show();$("#p"+(e-0)).show();$("#p"+(e+1)).show();$("#p"+(e+2)).show();manageZIndex(e);TweenMax.to($("#oleft"),0,{opacity:0});TweenMax.to($("#oright"),0,{opacity:0});$("#oleft").show();$("#oright").show()}function updateZIndexDuringTurn(e){if(true)manageZIndex(e)}function manageZIndex(e){var t=obj["angle"];if(true){if(e%2===0){if(t<-90){$("#p"+e).css("zIndex",1);$("#p"+(e-1)).css("zIndex",1);$("#p"+(e+1)).css("zIndex",3);$("#p"+(e+2)).css("zIndex",3)}else{$("#p"+e).css("zIndex",3);$("#p"+(e-1)).css("zIndex",3);$("#p"+(e+1)).css("zIndex",1);$("#p"+(e+2)).css("zIndex",1)}}else{if(t>90){$("#p"+e).css("zIndex",1);$("#p"+(e+1)).css("zIndex",1);$("#p"+(e-1)).css("zIndex",3);$("#p"+(e-2)).css("zIndex",3)}else{$("#p"+e).css("zIndex",3);$("#p"+(e+1)).css("zIndex",3);$("#p"+(e-1)).css("zIndex",1);$("#p"+(e-2)).css("zIndex",1)}}}else{if(e%2===0){$("#p"+(e-1)).css("zIndex",1);$("#p"+e).css("zIndex",4);$("#p"+(e+1)).css("zIndex",3);$("#p"+(e+2)).css("zIndex",1)}else{$("#p"+(e-2)).css("zIndex",1);$("#p"+(e-1)).css("zIndex",3);$("#p"+e).css("zIndex",4);$("#p"+(e+1)).css("zIndex",1)}}}function updateOverlay(e,t){if(e=="right-to-left"){opacity=0;if(t>-90)opacity=1+t/90;if(current_page==num_pages-2)opacity=0;TweenMax.to($("#oright"),speed_on_dragging,{opacity:opacity*max_overlay_opacity});opacity=0;if(t<-90)opacity=-(t+90)/90;if(current_page==0)opacity=0;TweenMax.to($("#oleft"),speed_on_dragging,{opacity:opacity*max_overlay_opacity})}else{opacity=0;if(t>90)opacity=1-(180-t)/90;if(current_page==num_pages)opacity=0;TweenMax.to($("#oright"),speed_on_dragging,{opacity:opacity*max_overlay_opacity});opacity=0;if(t<90)opacity=1-t/90;if(current_page==2)opacity=0;TweenMax.to($("#oleft"),speed_on_dragging,{opacity:opacity*max_overlay_opacity})}}function manageCoverViews(e,t){if(view=="two"){if(e==0)book_x=(ww-page_width*3)/2;else if(e==num_pages)book_x=(ww-page_width)/2;else book_x=(ww-page_width*2)/2}else book_x=(ww-page_width*3)/2;TweenMax.to($("#book"),t,{z:.1,x:book_x});TweenMax.to($("#big"),t,{x:book_x})}function gotoPage(e){if(e>current_page)view=="two"?gotoLeft(e):gotoLeftOne(e);else if(e<current_page)view=="two"?gotoRight(e):gotoRightOne(e)}function gotoLeft(e){if(e%2==1)e++;if(turning||e==current_page)return;turning=true;completing=true;hideAllMaps();turn_p1=current_page-1;turn_p2=current_page;turn_p3=e-1;turn_p4=e;$(".page").hide();$("#p"+turn_p1).show();$("#p"+turn_p2).show();$("#p"+turn_p3).show();$("#p"+turn_p4).show();var t=current_page;current_page=e;obj["angle"]=0;TweenMax.to($("#oleft"),0,{opacity:0});TweenMax.to($("#oright"),0,{opacity:0});$("#oleft").show();$("#oright").show();for(i=0;i<num_pages;i++)if(i!=turn_p1&&i!=turn_p2&&i!=turn_p3&&i!=turn_p4)$("#p"+i).css("zIndex",0).hide();$("#p"+turn_p1).css("zIndex",1);$("#p"+turn_p2).css("zIndex",3);$("#p"+turn_p3).css("zIndex",3);$("#p"+turn_p4).css("zIndex",1);manageCoverViews(current_page,speed_turn);if(t!=0)TweenMax.fromTo($("#oleft"),speed_turn,{opacity:-1},{opacity:1});if(current_page<num_pages-1)TweenMax.fromTo($("#oright"),speed_turn,{opacity:1},{opacity:-1});TweenMax.to(obj,speed_turn,{angle:-180,onUpdate:updateZIndexDuringGotoLeft,onUpdateParams:[current_page]});TweenMax.to($("#p"+turn_p2),speed_turn,{z:.1,rotationY:-180,onComplete:function(){onTurnComplete();for(i=t;i<current_page;i++)if(i%2==0)TweenMax.to($("#p"+i),0,{z:.1,rotationY:-180});else TweenMax.to($("#p"+i),0,{z:.1,rotationY:0})}});TweenMax.to($("#p"+turn_p3),speed_turn,{z:.1,rotationY:0})}function gotoLeftOne(e){if(turning||e==current_page)return;turning=true;completing=true;hideAllMaps();turn_p1=current_page;turn_p2=e;var t=current_page;current_page=e;obj["angle"]=0;TweenMax.to($("#oright"),0,{opacity:0});$("#oright").show();for(i=0;i<num_pages;i++)if(i!=turn_p1&&i!=turn_p2)$("#p"+i).css("zIndex",0).hide();$("#p"+turn_p1).css("zIndex",3);$("#p"+turn_p2).css("zIndex",1);$(".page").hide();$("#p"+turn_p1).show();$("#p"+turn_p2).show();TweenMax.fromTo($("#oright"),speed_turn,{opacity:1},{opacity:0});TweenMax.to($("#p"+turn_p1),speed_turn,{z:.1,rotationY:-one_page_max_angle,onComplete:function(){onTurnComplete();for(i=t;i<current_page;i++)TweenMax.to($("#p"+i),0,{z:.1,rotationY:-one_page_max_angle})}})}function gotoRight(e){if(view=="two"&&e%2==1)e++;if(e==current_page)return;if(turning)return false;turning=true;completing=true;hideAllMaps();var t=current_page;turn_p1=e-1;turn_p2=e;turn_p3=current_page-1;turn_p4=current_page;$(".page").hide();$("#p"+turn_p1).show();$("#p"+turn_p2).show();$("#p"+turn_p3).show();$("#p"+turn_p4).show();current_page=e;obj["angle"]=0;TweenMax.to($("#oleft"),0,{opacity:0});TweenMax.to($("#oright"),0,{opacity:0});$("#oleft").show();$("#oright").show();for(i=0;i<num_pages;i++)if(i!=turn_p1&&i!=turn_p2&&i!=turn_p3&&i!=turn_p4)$("#p"+i).css("zIndex",0).hide();$("#p"+turn_p1).css("zIndex",1);$("#p"+turn_p2).css("zIndex",3);$("#p"+turn_p3).css("zIndex",3);$("#p"+turn_p4).css("zIndex",1);manageCoverViews(current_page,speed_turn);if(current_page!=0)TweenMax.fromTo($("#oleft"),speed_turn,{opacity:1},{opacity:-1});if(t<num_pages-1)TweenMax.fromTo($("#oright"),speed_turn,{opacity:-1},{opacity:1});TweenMax.to(obj,speed_turn,{angle:180,onUpdate:updateZIndexDuringGotoRight,onUpdateParams:[current_page]});TweenMax.to($("#p"+turn_p2),speed_turn,{z:.1,rotationY:0,onComplete:function(){onTurnComplete();for(i=current_page+1;i<t;i++)if(i%2==0)TweenMax.to($("#p"+i),0,{z:.1,rotationY:0});else TweenMax.to($("#p"+i),0,{z:.1,rotationY:180})}});TweenMax.to($("#p"+turn_p3),speed_turn,{z:.1,rotationY:180})}function gotoRightOne(e){if(turning||e==current_page)return;turning=true;completing=true;hideAllMaps();turn_p1=e;turn_p2=current_page;var t=current_page;current_page=e;obj["angle"]=0;TweenMax.to($("#oright"),0,{opacity:0});$("#oright").show();for(i=0;i<num_pages;i++)if(i!=turn_p1&&i!=turn_p2)$("#p"+i).css("zIndex",0).hide();$("#p"+turn_p1).css("zIndex",3);$("#p"+turn_p2).css("zIndex",1);$(".page").hide();$("#p"+turn_p1).show();$("#p"+turn_p2).show();TweenMax.fromTo($("#oright"),speed_turn,{opacity:0},{opacity:1});TweenMax.to($("#p"+turn_p1),speed_turn,{z:.1,rotationY:0,onComplete:function(){onTurnComplete();for(i=current_page;i<t;i++)TweenMax.to($("#p"+i),0,{z:.1,rotationY:0})}})}function updateZIndexDuringGotoLeft(e){var t=obj["angle"];if(t<-90){$("#p"+turn_p2).css("zIndex",1);$("#p"+turn_p3).css("zIndex",3)}else{$("#p"+turn_p2).css("zIndex",3);$("#p"+turn_p3).css("zIndex",1)}}function updateZIndexDuringGotoRight(e){var t=obj["angle"];if(t>90){$("#p"+turn_p2).css("zIndex",3);$("#p"+turn_p3).css("zIndex",1)}else{$("#p"+turn_p2).css("zIndex",1);$("#p"+turn_p3).css("zIndex",3)}}function turnLeft(){if(current_page>=num_pages-1)return false;gotoPage(current_page+1)}function turnRight(){if(current_page==0)return false;gotoPage(view=="two"?current_page-2:current_page-1)}function toggleMaps(e){if(maps_visibility[e]){hideMaps(e)}else{showMaps(e)}}function showMaps(e){maps_visibility[e]=true;TweenMax.to($("#maps_"+e+" .map"),0,{scale:0});TweenMax.to($("#maps_"+e+" .icon"),0,{rotationZ:-180});$("#maps_"+e+" .map").fadeIn(150);$("#maps_"+e+" .icon").fadeIn(150);TweenMax.to($("#maps_"+e+" .map"),.5,{z:.5,scale:1,ease:Back.easeOut});TweenMax.to($("#maps_"+e+" .icon"),.8,{z:.5,rotationZ:0,ease:Back.easeOut})}function hideAllMaps(){for(p=0;p<num_pages;p++){$("#maps_"+p+" .map").fadeOut(300);$("#maps_"+p+" .icon").fadeOut(300)}}function scaleMaps(){var e=page_width/661;for(var t=0;t<num_pages;t++){for(var n=0;n<maps[t].length;n++){$("#map_"+t+"_"+n).css("left",maps[t][n].left*e);$("#map_"+t+"_"+n).css("top",maps[t][n].top*e);if($("#map_"+t+"_"+n).hasClass("icon")){res=$("#map_"+t+"_"+n).attr("resize");$("#map_"+t+"_"+n).width(maps[t][n].width*e*res/100);$("#map_"+t+"_"+n).height(maps[t][n].height*e*res/100)}else{$("#map_"+t+"_"+n).width(maps[t][n].width*e);$("#map_"+t+"_"+n).height(maps[t][n].height*e)}}}}function initThumbScroll(){if(iscroll_thumbs_enabled){iscroll_thumbs.destroy();iscroll_thumbs=null}iscroll_thumbs_enabled=true;iscroll_thumbs=new iScroll("thumbs",{scrollbarClass:"iscroll",vScroll:false,bounce:true,hideScrollbar:true,fadeScrollbar:true,onScrollStart:function(){},onScrollMove:function(){iscroll_thumbs_dragging=true},onScrollEnd:function(){iscroll_thumbs_dragging=false}})}function toggleThumbs(){if(thumb_opened)closeThumbs();else openThumbs()}function openThumbs(){thumb_opened=true;hideArrows();TweenMax.to($("#thumbs"),.5,{z:.9,y:60});closeSommario()}function closeThumbs(){thumb_opened=false;TweenMax.to($("#thumbs"),.5,{z:.9,y:-200,onComplete:function(){}});if(header_opened&&!sommario_opened&&!thumb_opened)showArrows(0)}function initSommario(){if(iscroll_sommario_inited){iscroll_sommario.destroy();iscroll_sommario=null}iscroll_sommario_inited=true;iscroll_sommario=new iScroll("sommario",{bounce:true,hScroll:false,scrollbarClass:"iscroll",hideScrollbar:true,fadeScrollbar:true,onScrollStart:function(){},onScrollMove:function(){iscroll_sommario_dragging=true},onScrollEnd:function(){iscroll_sommario_dragging=false}})}function toggleSommario(){if(sommario_opened)closeSommario();else openSommario()}function openSommario(){sommario_opened=true;hideArrows();TweenMax.to($("#sommario"),.4,{x:0});closeThumbs()}function closeSommario(){sommario_opened=false;TweenMax.to($("#sommario"),.4,{x:sommario_left});if(header_opened&&!sommario_opened&&!thumb_opened)showArrows(0)}function toggleHeader(){header_opened?hideHeader():showHeader()}function showHeader(e){if(hide_header)return false;e=typeof e!=="undefined"?e:0;if(!header_opened){header_opened=true;TweenMax.to($("#header"),.3,{top:0,delay:e,ease:Quad.easeOut,onComplete:function(){}})}}function hideHeader(){if(header_opened){header_opened=false;TweenMax.killTweensOf($("#header"));TweenMax.to($("#header"),.3,{top:-100,ease:Quad.easeIn})}}function showArrows(e){arrows_visible=true;e=typeof e!=="undefined"?e:0;TweenMax.to($("#arrow_left"),.3,{x:0,delay:e,ease:Quad.easeOut});TweenMax.to($("#arrow_right"),.3,{x:ww-arrow_bar_width,delay:e,ease:Quad.easeOut})}function hideArrows(){arrows_visible=false;TweenMax.killTweensOf($("#arrow_left"));TweenMax.killTweensOf($("#arrow_right"));TweenMax.to($("#arrow_left"),.2,{x:-100,ease:Quad.easeIn});TweenMax.to($("#arrow_right"),.2,{x:ww+10,ease:Quad.easeIn})}function hideAll(){hideArrows();hideHeader();closeSommario();closeThumbs()}function freePages(){var e=current_page-Math.ceil(num_loaded_pages/2);var t=current_page+Math.ceil(num_loaded_pages/2)+1;freePagesFromTo(0,e);freePagesFromTo(t,num_pages)}function freePagesFromTo(e,t){for(i=e;i<t;i++){if(loaded_pages[i]){var n=$("#p"+i+"_img");n.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBwABACwAAAAAAQABAAACAkQBACH5BAUHAAEALAAAAAABAAEAAAICTAEAIfkEBQcAAQAsAAAAAAEAAQAAAgJMAQAh+QQFBwABACwAAAAAAQABAAACAkwBACH5BAUHAAEALAAAAAABAAEAAAICTAEAIfkEBQcAAQAsAAAAAAEAAQAAAgJMAQAh+QQFBwABACwAAAAAAQABAAACAkwBACH5BAUHAAEALAAAAAABAAEAAAICTAEAOw==");loaded_pages[i]=false}}}function loadPages(){freePages();var e=current_page-Math.ceil(num_loaded_pages/2);e=Math.max(0,e);var t=current_page+Math.ceil(num_loaded_pages/2)+1;t=Math.min(num_pages,t);for(i=e;i<t;i++){if(!loaded_pages[i]){var n=$("#p"+i+"_img");n.attr("src",path_big+n.attr("big"));loaded_pages[i]=true}}}function startPreload(){loadNext()}function loadNext(){if(preload_current===preload_images.length)return false;var e=new Image;e.onerror=function(){preload_current++;updateProgress();loadNext()};e.onload=function(){preload_current++;updateProgress();loadNext()};e.src=preload_images[preload_current]}function updateProgress(){preload_loaded++;var e=preload_loaded/preload_images.length*100;$("#preload_text").html(Math.round(e)+"%");TweenMax.to($("#preload_bar"),.3,{z:.1,width:e+"%"});if(preload_loaded==preload_images.length){$("#preload_text").html("100%");TweenMax.to($("#preload_bar"),.3,{z:.1,width:100+"%",onComplete:preloadComplete})}}function preloadComplete(){init()}function resizePreload(){$("#preload").css("marginTop",wh/2-50);$("#preload_bg").width(ww);$("#preload_bg").height(wh)}function showOverlay(){resizeOverlay();$("#dark_overlay").fadeIn("slow")}function resizeOverlay(){$("#dark_overlay").css("left",0);$("#dark_overlay").css("top",0);$("#dark_overlay").width(ww);$("#dark_overlay").height(wh)}function hideOverlay(){$("#dark_overlay").fadeOut("slow")}function resizeTextIframe(){var e=Math.min(ww-ww*.1,900);var t=wh-wh*.1;var n=(ww-e)/2;var r=wh*.05;TweenMax.to($("#text_iframe"),0,{x:n,y:r,width:e,height:t});TweenMax.to($("#text_iframe_close"),0,{x:n+e-6,y:r-22})}function hideTextIframe(){$("#dark_overlay").fadeOut("slow");$("#text_iframe").fadeOut("slow");$("#text_iframe_close").fadeOut("slow",function(){popup_opened=false})}var page_height;var page_width;var main_dimension;var current_page=0;var turning=false;var completing=false;var drag_page;var one_page_turn_direction;var popup_opened=false;var zoomed=false;var current_zoom=1;var start_drag_zoomed=false;var last_zoom;var last_large_x;var last_large_y;var current_large_x;var current_large_y;var current_big_x;var current_big_y;var book_page_view="center";var arrows_visible=false;var turn_p1;var turn_p2;var turn_p3;var turn_p4;var ww;var wh;var perspective;var view;var book_x;var book_y;var sommario_left;var speed_complete_turn=.6;var speed_complete_turn_one=.3;var speed_turn=.6;var speed_on_dragging=.4;var max_overlay_opacity=1.2;var drag_threshold=100;var one_page_drag_threshold=1;var one_page_max_angle=90;var perspective_multiplier=3.5;var max_zoom=3;var zoom_speed=.8;var fullscreen=false;$(document).ready(function(){if(!$.fullscreen.isNativelySupported())$("#icon_fullscreen").hide();document.onselectstart=new Function("return false");$("img").on("dragstart",function(e){e.preventDefault()});$(window).bind("orientationchange",function(){onOrientationChange()});determineView();TweenMax.to($("#arrow_left"),0,{z:.7,x:-100,onComplete:function(){$("#arrow_left").show()}});TweenMax.to($("#arrow_right"),0,{z:.7,x:ww+10,onComplete:function(){$("#arrow_right").show()}});TweenMax.to($("#thumbs"),0,{z:.9,top:0,y:-200});TweenMax.to($("#sommario"),0,{z:.9,left:0,x:-1e3});TweenMax.to($(".maps"),0,{z:.3});TweenMax.to($(".map"),0,{z:.3});TweenMax.to($(".icon"),0,{z:.3});TweenMax.to($("#header"),0,{z:.4});$(window).resize(onResize);resizeAll();if(magazine_ready)startPreload();else{$("#preload_text").html("The publication is not yet ready<br/>Please try again later..")}});var logo_width=0;var logo_height=0;var first_time_resize=true;var obj={angle:0};maps_visibility=new Array;for(var p=0;p<num_pages;p++)maps_visibility[p]=false;var iscroll_thumbs;var iscroll_thumbs_enabled=false;var iscroll_thumbs_dragging=false;var thumb_opened=false;var iscroll_sommario_inited=false;var iscroll_sommario_dragging=false;var sommario_opened=false;var header_opened=false;var preload_current=0;var preload_loaded=0